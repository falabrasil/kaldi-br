### Author
Cassio Batista

### Hardware details
```bash
$ neofetch                                   $ cpufetch 
OS:        Arch Linux x86_64                 Name:       Intel(R) Core(TM) i5-4440 CPU @ 3.10GHz
Host:      LOG-H81H3M4 1.0                   Frequency:  3.30GHz
Kernel:    5.6.6-arch1-1                     N.Cores:    4 cores
Uptime:    2 days, 11 hours, 1 min           AVX:        AVX,AVX2
Packages:  712 (pacman)                      SSE:        SSE,SSE2,SSE3,SSSE3,SSE4_1,SSE4_2
Shell:     bash 5.0.16                       FMA:        FMA3
Terminal:  /dev/pts/0                        AES:        Yes
CPU:       Intel i5-4440 (4) @ 3.300GHz      SHA:        No
GPU:       NVIDIA TITAN Xp                   L1 Size:    32KB(Data)32KB(Instructions)
Memory:    154MiB / 7900MiB                  L2 Size:    256KB
                                             L3 Size:    6144KB
                                             Peak FLOPS: 422.40 GFLOP/s
```

```text
$ free -m
              total        used        free      shared  buff/cache   available
Mem:           7900         142        7329           0         428        7502
Swap:          8191          54        8137
```

```text
$ nvidia-smi 
Sun Apr 26 02:16:53 2020 
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 440.82       Driver Version: 440.82       CUDA Version: 10.2     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  TITAN Xp            Off  | 00000000:01:00.0 Off |                  N/A |
| 24%   42C    P0    58W / 250W |      0MiB / 12192MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID   Type   Process name                             Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
```

### Command line error
```text
teps/nnet3/chain/get_egs.sh: creating 62 archives, each with 18639 egs, with
steps/nnet3/chain/get_egs.sh:   140,100,160 labels per example, and (left,right) context = (30,30)
steps/nnet3/chain/get_egs.sh: Getting validation and training subset examples in background.
steps/nnet3/chain/get_egs.sh: Generating training examples on disk
steps/nnet3/chain/get_egs.sh: Getting subsets of validation examples for diagnostics and combination.
steps/nnet3/chain/get_egs.sh: recombining and shuffling order of archives on disk
run.pl: 36 / 62 failed, log is in exp/chain_online_cmn/tdnn1k_sp/egs/log/shuffle.*.log
Traceback (most recent call last):
  File "steps/nnet3/chain/train.py", line 644, in main
    train(args, run_opts)
  File "steps/nnet3/chain/train.py", line 405, in train
    stage=args.egs_stage)
  File "steps/libs/nnet3/train/chain_objf/acoustic_model.py", line 118, in generate_chain_egs
    egs_opts=egs_opts if egs_opts is not None else ''))
  File "steps/libs/common.py", line 158, in execute_command
    p.returncode, command))
Exception: Command exited with status 1: steps/nnet3/chain/get_egs.sh --frames-overlap-per-eg 0 --online-cmvn true   --cmd "run.pl --mem 4G"   --cmvn-opts "--config=conf/online_cmvn.conf"   --online-ivector-dir "exp/nnet3_online_cmn/ivectors_train_sp_hires"   --left-context 30   --right-context 30   --left-context-initial -1   --right-context-final -1   --left-tolerance '5'   --right-tolerance '5'   --frame-subsampling-factor 3   --alignment-subsampling-factor 3   --stage 0   --frames-per-iter 3000000   --frames-per-eg 140,100,160   --srand 0   data/train_sp_hires exp/chain_online_cmn/tdnn1k_sp exp/chain_online_cmn/tri3b_train_sp_lats exp/chain_online_cmn/tdnn1k_sp/egs
```

### Log entries under `exp/chain*/tdnn*/egs/log/shuffle*.log`
```bash
$ grep -i ^error shuffle.*
shuffle.10.log:ERROR: CompactFst write failed: <unknown>
shuffle.16.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:Write():compressed-matrix.cc:563) Error writing compressed matrix to stream.
shuffle.16.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:Write():util/kaldi-table-inl.h:1515) Error in TableWriter::Write
shuffle.16.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:~TableWriter():util/kaldi-table-inl.h:1539) Error closing TableWriter [in destructor].
shuffle.17.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:Write():compressed-matrix.cc:563) Error writing compressed matrix to stream.
shuffle.17.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:Write():util/kaldi-table-inl.h:1515) Error in TableWriter::Write
shuffle.17.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:~TableWriter():util/kaldi-table-inl.h:1539) Error closing TableWriter [in destructor].
shuffle.28.log:ERROR: CompactFst write failed: <unknown>
shuffle.28.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:WriteToken():io-funcs.cc:141) Write failure in WriteToken.
shuffle.28.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:Write():util/kaldi-table-inl.h:1515) Error in TableWriter::Write
shuffle.28.log:ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:~TableWriter():util/kaldi-table-inl.h:1539) Error closing TableWriter [in destructor].
...
```

```bash
$ tail -n 20 shuffle.10.log
WARNING (nnet3-chain-normalize-egs[5.5.665~1-344cd]:Close():util/kaldi-table-inl.h:1089) Error closing stream: wspecifier is ark:-
ERROR (nnet3-chain-normalize-egs[5.5.665~1-344cd]:~TableWriter():util/kaldi-table-inl.h:1539) Error closing TableWriter [in destructor].

[ Stack-Trace: ]
/home/cassio/git-all/kaldi/src/lib/libkaldi-base.so(kaldi::MessageLogger::LogMessage() const+0x77c) [0x7f98c03e4a5c]
nnet3-chain-normalize-egs(kaldi::MessageLogger::LogAndThrow::operator=(kaldi::MessageLogger const&)+0x21) [0x55d33f91af6b]
nnet3-chain-normalize-egs(kaldi::TableWriter<kaldi::KaldiObjectHolder<kaldi::nnet3::NnetChainExample> >::~TableWriter()+0x89) [0x55d33f91ea8f]
nnet3-chain-normalize-egs(main+0x608) [0x55d33f919e41]
/usr/lib/libc.so.6(__libc_start_main+0xf3) [0x7f989479f023]
nnet3-chain-normalize-egs(_start+0x2e) [0x55d33f91976e]

terminate called after throwing an instance of 'kaldi::KaldiFatalError'
  what():  kaldi::KaldiFatalError
cat: write error: Broken pipe
bash: line 1: 298150 Aborted                 (core dumped) nnet3-chain-normalize-egs --normalization-fst-scale=1.0 exp/chain_online_cmn/tdnn1k_sp/normalization.fst "ark:cat  exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.1.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.2.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.3.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.4.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.5.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.6.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.7.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.8.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.9.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.10.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.11.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.12.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.13.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.14.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.15.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.16.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.17.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.18.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.19.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.20.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.21.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.22.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.23.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.24.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.25.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.26.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.27.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.28.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.29.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.30.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.31.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.32.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.33.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.34.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.35.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.36.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.37.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.38.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.39.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.40.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.41.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.42.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.43.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.44.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.45.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.46.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.47.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.48.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.49.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.50.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.51.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.52.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.53.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.54.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.55.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.56.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.57.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.58.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.59.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.60.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.61.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.62.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.63.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.64.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.65.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.66.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.67.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.68.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.69.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.70.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.71.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.72.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.73.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.74.10.ark exp/chain_online_cmn/tdnn1k_sp/egs/cegs_orig.75.10.ark|" ark:-
     298151 Killed                  | nnet3-chain-shuffle-egs --srand=$[10+0] ark:- ark:exp/chain_online_cmn/tdnn1k_sp/egs/cegs.10.ark
# Accounting: time=2764 threads=1
# Ended (code 137) at Sat Apr 25 13:39:35 -03 2020, elapsed time 2764 seconds
```

### Possible cause
- Not enough memory (8G desktop)
- Kaldi wasnt developed to train models on single desktops


### Referece
- "error egs generation": https://groups.google.com/forum/#!topic/kaldi-help/pyIqBop6KvI

> "possibly some of the programs were killed due to out-of-memory. 
> This is more likely to happen if you are parallelizing using run.pl 
> instead of GridEngine or slurm or things like that, since there is 
> no way to limit how many jobs run in parallel."
